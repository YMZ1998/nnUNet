syntax = "proto3";
package dtai;
import "base.proto";

message request {
    message navigate_t {
        string project_id = 1;
        string simples_id = 2;
        string module_id = 3;
    }

    message generic {
        navigate_t nav = 1;
    }

    //project
    message create_project {
        navigate_t nav = 1;
        project_t payload = 2;
    }

    message edit_project {
        navigate_t nav = 1;
        project_t payload = 2;
    }

    message delete_project {
        navigate_t nav = 1;
    }

    message list_project {
        int32 page_size = 1;
        int32 page_index = 2;
        bool ascend = 3;
        string sort_name = 4;
        string search = 5;
        bool show_deleted = 6;
    }
    //simples 
    message create_set {
        navigate_t nav = 1;
        string name = 2;
        string tag = 3;
        string description = 4;
    }

    message edit_set {
        navigate_t nav = 1;
        string name = 2;
        string tag = 3;
        string description = 4;
    }

    message lock_set {
       navigate_t nav = 1; 
       bool lock = 2;
    }

    message delete_set {
       navigate_t nav = 1; 
       bool delete = 2;
    }

    message list_set {
        navigate_t nav = 1; 
        int32 page_size = 2;
        int32 page_index = 3;
        bool ascend = 4;
        string sort_name = 5;
        string search = 6;
        bool show_deleted = 7;
    }

    message import_simple {
        navigate_t nav = 1;
        string patient_id = 2;
        string image_id = 3;
        string image_name = 4;
        string rtss_id = 5;
        string rtss_name = 6;
    }

    message list_simple_id {
       navigate_t nav = 1; 
    }

    message get_simple_data {
       navigate_t nav = 1; 
       string simple_id = 2;
    }

    message save_simples {
       navigate_t nav = 1;
       repeated simple_set_t.simple_t modify_simples = 2;
       repeated simple_set_t.simple_t delete_simples = 3;
    }

    message get_simples_info {
        navigate_t nav = 1; 
    }
    //algo
    message list_algo {
       navigate_t nav = 1; 
    }
    //module
    message create_module {
        navigate_t nav = 1;
        string name = 2; 
    }

    message rename_module {
        navigate_t nav = 1; 
        string new_name = 2;
    }

    message delete_module {
        navigate_t nav = 1; 
        bool delete = 2;
     }

    message list_module {
        navigate_t nav = 1; 
        int32 page_size = 2;
        int32 page_index = 3;
        bool show_deleted = 4;
    }

    message create_task {
        navigate_t nav = 1;
        string algo = 2;
        string training_simples_id = 3;
        string test_simples_id = 4;
        repeated string training_part = 5;
        repeated string vaild_part = 6;
        string preprocess_args = 7;
        string training_args = 8;
        string description = 9;
        string device_id = 10;
        bool redo = 11;
    }

    message control_task {
        navigate_t nav = 1; 
        string version_id = 2;
        module_version_t.action_t action = 3;
    }

    message import_module {
        navigate_t nav = 1;
        string version_id = 2;     //for worker
        int64 total_size = 3;
        string md5 = 4;
    }

    message upload_module_file {
        navigate_t nav = 1; 
        string file_id = 2;
        int64 part_size = 3;
        bytes data = 4;
        bool finish = 5;
    }

    message get_version_data {
        navigate_t nav = 1;
        string version_id = 2; 
    }
    //assessment
    message create_assessment {
        navigate_t nav = 1;
        module_t.source_t source = 2;
        string source_id = 3;
        string test_simples_id = 4;
        string device_id = 5;
        string oss_path = 6;
    }

    message list_assessment {
        navigate_t nav = 1;
    }

    message save_assessment_description {
        navigate_t nav = 1; 
        string assessment_id = 2;
        string description = 3;
    }

    //device
    message register_device {               //worker
        string device_id = 1;
        string name = 2;
        string ip = 3;
        repeated device_t.gpu_t gpus = 4;
    }

    message heartbeat {                     //worker
        string device_id = 1;
    }

    message query_training_task {
        string device_id = 1;
    }

    message query_training_task_control {
        string device_id = 1; 
        string update_source_id = 2; 
    }

    message update_training_task {
        string device_id = 1;
        string update_source_id = 2;
        module_version_t.status_t status = 3;
        int32 progress = 4;
        string error_message = 5;
        module_version_data_t.point_t point = 6;
    }

    message complated_training_control {
        string device_id = 1;  
        string source_id = 2;
    }

    message query_assessment_task {
        string device_id = 1;
    }

    message complated_assessment_task {
        string device_id = 1;
        string update_source_id = 2;
        assessment_t.status_t status = 3;
        string error_message = 4;
        repeated assessment_t.dice_t dices = 5;
    }

    message list_device {
        navigate_t nav = 1; 
        int32 page_size = 2;
        int32 page_index = 3;
        bool ascend = 4;
        string sort_name = 5;
        string search = 6;
    } 
}

message response {
    message result_t {
        string status = 1;
        string error_msg = 2;
    }
    
    message generic {
        result_t result = 1; 
    }

//project
    message create_project {
       result_t result = 1;
       string project_id = 2; 
    }

    message list_project {
        result_t result = 1;
        repeated project_t list = 2;
        int32 total_number = 3;
    }
//simples
    message create_set {
        result_t result = 1;
        string simples_id = 2;
    }
    
    message list_set {
        result_t result = 1;
        repeated simple_set_t list = 2;
        int32 total_number = 3;
    }

    message import_simple {
        result_t result = 1;
        string simple_id = 2;
    }

    message list_simple_id {
        result_t result = 1;
        repeated string ids = 2;
    }

    message get_simple_data {
       result_t result = 1;
       repeated simple_set_t.simple_t data = 2;
    }

    message get_simples_info {
        result_t result = 1;
        string name = 2;
        string tag = 3;
        string ref_project_id = 4;
        string create_time = 5;
        string last_modify_time = 6;
    }
    //algo
    message list_algo {
        result_t result = 1; 
        algo_t algos = 2;
    }
    //module
    message create_module {
        result_t result = 1;
        string module_id = 2;
    }

    message list_module {
        message record_t {
            message version_t {
                string simples_name = 1;
                module_version_t data = 2; 
            }
            module_t module = 1;
            repeated version_t versions = 2;
        }
        result_t result = 1;
        repeated record_t records = 2; 
        int32 total_number = 3;
    }

    message import_module {
        result_t result = 1;
        string file_id = 2;
    }

    message get_version_data {
        result_t result = 1;
        module_version_data_t data = 2;
    }
    //assessment
    message list_assessment {
        result_t result = 1; 
        repeated assessment_t records = 2;  
    }

    //device
    message list_device {
        result_t result = 1;
        repeated device_t list = 2;
        int32 total_number = 3;
    }

    message query_training_task {
        result_t result = 1;
        repeated device_t.work_t.training_work_t training_works = 2; // always 1
    }

    message query_assessment_task {
        result_t result = 1;
        repeated device_t.work_t.assessment_work_t assessment_works = 2; // always 1
    }

    message query_training_task_control {
        result_t result = 1;
        module_version_t.action_t action = 2;
    }
}

